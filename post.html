<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="icon" type="image/png" href="assets/images/PR.png">
  <title>Aktualność – Polacy Rodacy</title>
  <link rel="stylesheet" href="style/style.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <meta property="og:title" content="Polacy Rodacy - Esports Team">
<meta property="og:description" content="Official website of Polacy Rodacy, Brawl Stars team.">
<meta property="og:image" content="https://polacyrodacy.github.io/Main/assets/images/og-main.jpg">
<meta property="og:url" content="https://polacyrodacy.github.io/Main/post.html">

</head>
<body>
  <nav><div class="nav-container"><ul class="nav-links"><a href="news.html">← Back to News</a></ul></div></nav>

  <main style="max-width:900px;margin:2rem auto;padding:0 1rem;">
    <div id="post-root">
      <p>Loading post...</p>
    </div>
  </main>

<script>
(async function(){
  const repoRawBase = "https://raw.githubusercontent.com/polacyrodacy/Main/main/news/";
  const params = new URLSearchParams(location.search);
  const date = params.get('date');
  const root = document.getElementById('post-root');

  if (!date) {
    root.innerHTML = "<p>No date provided in URL.</p>";
    return;
  }

  try {
    // load index.json
    const res = await fetch(repoRawBase + "index.json");
    if (!res.ok) {
      const txt = await res.text();
      console.error("index.json fetch not OK:", res.status, txt);
      root.innerHTML = `<p style="color:red;">Failed to load index.json (HTTP ${res.status}).</p>`;
      return;
    }
    const posts = await res.json();
    const post = posts.find(p => p.date === date);
    if (!post) {
      root.innerHTML = "<p>Post not found for that date.</p>";
      return;
    }

    // set title
    document.title = `${post.title} – Polacy Rodacy`;

    // image (fallback)
    const image = post.image || 'assets/images/PR.png';

    // load markdown file
    const mdRes = await fetch(repoRawBase + post.file);
    if (!mdRes.ok) {
      const raw = await mdRes.text();
      console.error("Markdown fetch error:", mdRes.status, raw);
      root.innerHTML = `<p style="color:red;">Failed to load article file (HTTP ${mdRes.status}). Check console.</p>`;
      return;
    }
    const mdText = await mdRes.text();
    const html = marked.parse(mdText);

    root.innerHTML = `
      <img src="${image}" alt="${post.title}" style="width:100%;max-height:420px;object-fit:cover;border-radius:12px;margin-bottom:1rem;">
      <h1>${post.title}</h1>
      <small style="opacity:.8">${post.date}</small>
      <article class="news-body" style="margin-top:1rem;">${html}</article>
    `;

  } catch(err) {
    console.error("Error loading post:", err);
    root.innerHTML = `<p style="color:red;">Network/error loading post — check console.</p>`;
  }
})();
</script>

<script src="scripts/day-night.js"></script>
</body>
</html>
